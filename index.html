<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Model Viewer – Live Hotspot Position</title>

    <!-- model-viewer web component -->
    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js">
    </script>

    <style>
      :not(:defined) > * {
        display: none;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      model-viewer {
        flex: 1;
        min-height: 300px;
        background: #111;
      }

      .controls {
        padding: 12px 16px;
        background: #181818;
        color: #f5f5f5;
        font-size: 14px;
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px 24px;
        align-items: center;
      }

      .controls label {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .controls input[type="range"] {
        width: 100%;
      }

      .value {
        font-variant-numeric: tabular-nums;
        opacity: 0.8;
      }

      .Hotspot {
        border: none;
        background: #fff;
        width: 14px;
        height: 14px;
        border-radius: 999px;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.7);
        cursor: pointer;
      }

      .HotspotAnnotation {
        white-space: nowrap;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        font-size: 12px;
        margin-top: 8px;
      }
    </style>
  </head>

  <body>
    <model-viewer
      id="viewer"
      src="model.glb"
      ios-src="model.usdz"
      camera-controls
      ar
      shadow-intensity="1"
      environment-image="neutral"
      alt="Demo model with draggable hotspot">

      <!-- Hotspot we’ll move at runtime -->
      <button
        class="Hotspot"
        slot="hotspot-movable"
        data-position="0 0.2 0.2"
        data-normal="0 1 0"
        data-visibility-attribute="visible">
        <div class="HotspotAnnotation">Live hotspot</div>
      </button>
    </model-viewer>

    <div class="controls">
      <label>
        X position
        <input
          id="hotspot-x"
          type="range"
          min="-0.5"
          max="0.5"
          step="0.01"
          value="0"
        />
        <span class="value" id="hotspot-x-value">0.00</span>
      </label>

      <label>
        Y position
        <input
          id="hotspot-y"
          type="range"
          min="-0.5"
          max="0.5"
          step="0.01"
          value="0.20"
        />
        <span class="value" id="hotspot-y-value">0.20</span>
      </label>

      <label>
        Z position
        <input
          id="hotspot-z"
          type="range"
          min="-0.5"
          max="0.5"
          step="0.01"
          value="0.20"
        />
        <span class="value" id="hotspot-z-value">0.20</span>
      </label>
    </div>

    <script type="module">
      const viewer = document.getElementById('viewer');

      // This is the hotspot we’re moving
      const hotspotEl = viewer.querySelector('[slot="hotspot-movable"]');

      const xInput = document.getElementById('hotspot-x');
      const yInput = document.getElementById('hotspot-y');
      const zInput = document.getElementById('hotspot-z');

      const xLabel = document.getElementById('hotspot-x-value');
      const yLabel = document.getElementById('hotspot-y-value');
      const zLabel = document.getElementById('hotspot-z-value');

      function updateLabels(x, y, z) {
        xLabel.textContent = x.toFixed(2);
        yLabel.textContent = y.toFixed(2);
        zLabel.textContent = z.toFixed(2);
      }

      function updateHotspotFromSliders() {
        const x = parseFloat(xInput.value);
        const y = parseFloat(yInput.value);
        const z = parseFloat(zInput.value);

        updateLabels(x, y, z);

        // IMPORTANT: model-viewer looks at the literal data-position string.
        const posString = `${x} ${y} ${z}`;
        hotspotEl.setAttribute('data-position', posString);

        // On newer versions, this is optional but forces an immediate recompute:
        if (typeof viewer.updateHotspot === 'function') {
          viewer.updateHotspot({
            name: 'hotspot-movable', // must match the slot name
            position: { x, y, z }
          });
        }
      }

      // Hook up sliders
      [xInput, yInput, zInput].forEach((input) => {
        input.addEventListener('input', updateHotspotFromSliders);
      });

      // Once the model is ready, sync the initial position with the sliders
      viewer.addEventListener('load', () => {
        updateHotspotFromSliders();
      });
    </script>
  </body>
</html>
